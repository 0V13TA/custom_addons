<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Repair Job Tree View -->
        <record id="view_repair_job_tree" model="ir.ui.view">
            <field name="name">auto.vehicle.repair.job.tree</field>
            <field name="model">auto.vehicle.repair.job</field>
            <field name="arch" type="xml">
                <list string="Repair Jobs" decoration-info="state=='work_order'" decoration-success="state=='done'" decoration-danger="state=='cancelled'" decoration-warning="state=='waiting_approval'">
                    <field name="name"/>
                    <field name="vehicle_id"/>
                    <field name="customer_id"/>
                    <field name="state" widget="badge"/>
                    <field name="quotation_amount"/>
                    <field name="assigned_mechanic_id"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                </list>
            </field>
        </record>

        <!-- Repair Job Form View -->
        <record id="view_repair_job_form" model="ir.ui.view">
            <field name="name">auto.vehicle.repair.job.form</field>
            <field name="model">auto.vehicle.repair.job</field>
            <field name="arch" type="xml">
                <form string="Repair Job">
                    <header>
                        <button name="action_to_quotation" string="To Quotation" type="object" class="oe_highlight" invisible="state != 'inspection'"/>
                        <button name="%(action_inspection_report)d" string="Print Inspection" type="action" class="btn-secondary" invisible="state == 'inspection'"/>
                        <button name="action_quotation_accepted" string="Quotation Accepted" type="object" class="oe_highlight" invisible="state not in ('quotation', 'waiting_approval')"/>
                        <button name="action_finalize_job" string="Done" type="object" class="oe_highlight" invisible="state != 'work_order' or not work_order_done_date"/>
                        <button name="%(action_work_order_report)d" string="Print Work Order" type="action" class="btn-secondary" invisible="state != 'work_order'"/>
                        <button name="action_cancel" string="Cancel" type="object" invisible="state in ('done', 'cancelled')"/>
                        <field name="state" widget="statusbar" statusbar_visible="inspection,quotation,work_order,done"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_quotation" type="object" class="oe_stat_button" icon="fa-file-text-o" invisible="not sale_order_id">
                                <field name="sale_order_id" widget="statinfo" string="Quotation"/>
                            </button>
                            <button name="%(action_work_order_report)d" type="action" class="oe_stat_button" icon="fa-wrench" invisible="state != 'work_order'">
                                <div class="o_stat_info">
                                    <span class="o_stat_text">Work Order</span>
                                    <span class="o_stat_value" invisible="not work_order_done_date">✓ Done</span>
                                </div>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="vehicle_id" options="{'no_create': False}"/>
                                <field name="customer_id"/>
                                <field name="assigned_mechanic_id" invisible="state == 'inspection'"/>
                                <field name="sale_order_id" invisible="not sale_order_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="inspection_date"/>
                                <field name="inspected_by_id"/>
                                <field name="inspection_mileage"/>
                                <field name="overall_condition" invisible="state == 'inspection'"/>
                                <field name="quotation_amount" invisible="state == 'inspection'" readonly="1"/>
                                <field name="approval_status" invisible="state not in ('work_order', 'done')"/>
                                <field name="start_date" invisible="state not in ('work_order', 'done')"/>
                                <field name="work_order_done_date" invisible="not work_order_done_date"/>
                                <field name="end_date" invisible="state != 'done'"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Inspection Details" name="inspection_details">
                                <group>
                                    <group string="General Inspection">
                                        <field name="inspection_date"/>
                                        <field name="inspected_by_id"/>
                                        <field name="inspection_mileage"/>
                                        <field name="overall_condition"/>
                                        <field name="estimated_repair_cost"/>
                                        <field name="inspection_images" widget="many2many_binary"/>
                                    </group>
                                    <group string="Engine">
                                        <field name="engine_condition"/>
                                        <field name="engine_oil_level"/>
                                        <field name="engine_coolant_level"/>
                                        <field name="engine_belts_condition"/>
                                        <field name="engine_notes" nolabel="1" placeholder="Engine inspection notes..."/>
                                    </group>
                                </group>
                                <group>
                                    <group string="Brakes">
                                        <field name="brakes_condition"/>
                                        <field name="brake_pads_thickness"/>
                                        <field name="brake_fluid_level"/>
                                        <field name="brakes_notes" nolabel="1" placeholder="Brakes inspection notes..."/>
                                    </group>
                                    <group string="Tires">
                                        <field name="tires_condition"/>
                                        <field name="tire_pressure_front"/>
                                        <field name="tire_pressure_rear"/>
                                        <field name="tire_tread_depth"/>
                                        <field name="tires_notes" nolabel="1" placeholder="Tires inspection notes..."/>
                                    </group>
                                </group>
                                <group>
                                    <group string="Electrical System">
                                        <field name="electrical_condition"/>
                                        <field name="battery_voltage"/>
                                        <field name="battery_condition"/>
                                        <field name="lights_condition"/>
                                        <field name="electrical_notes" nolabel="1" placeholder="Electrical system notes..."/>
                                    </group>
                                    <group string="Body &amp; Exterior">
                                        <field name="body_condition"/>
                                        <field name="paint_condition"/>
                                        <field name="windshield_condition"/>
                                        <field name="body_notes" nolabel="1" placeholder="Body inspection notes..."/>
                                    </group>
                                </group>
                                <group>
                                    <group string="Suspension &amp; Steering">
                                        <field name="suspension_condition"/>
                                        <field name="steering_condition"/>
                                        <field name="suspension_notes" nolabel="1" placeholder="Suspension inspection notes..."/>
                                    </group>
                                    <group string="Air Conditioning">
                                        <field name="ac_condition"/>
                                        <field name="ac_notes" nolabel="1" placeholder="AC inspection notes..."/>
                                    </group>
                                </group>
                                <group>
                                    <field name="inspection_notes" nolabel="1" placeholder="General inspection findings and notes..."/>
                                </group>
                            </page>
                            <page string="Quotation Lines" name="quotation_lines" invisible="state == 'inspection'">
                                <field name="quotation_line_ids" nolabel="1">
                                    <list>
                                        <field name="sequence" widget="handle"/>
                                        <field name="product_id"/>
                                        <field name="description"/>
                                        <field name="quantity"/>
                                        <field name="unit_price"/>
                                        <field name="subtotal" readonly="1"/>
                                        <field name="is_labor"/>
                                        <field name="labor_hours" invisible="not is_labor"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Work Order" name="work_order" invisible="state == 'inspection'">
                                <header>
                                    <button name="action_work_order_done" string="Work Order Done" type="object" class="oe_highlight" invisible="state != 'work_order' or work_order_done_date"/>
                                </header>
                                <group>
                                    <group string="Work Details">
                                        <field name="assigned_mechanic_id"/>
                                        <field name="start_date"/>
                                        <field name="work_order_done_date" invisible="not work_order_done_date"/>
                                        <field name="end_date" invisible="state != 'done'"/>
                                    </group>
                                    <group string="Work Information">
                                        <field name="work_description" nolabel="1" placeholder="Enter work description and notes here..."/>
                                    </group>
                                </group>
                                <group string="Inspection Summary" invisible="state == 'quotation'">
                                    <field name="inspection_notes" nolabel="1" readonly="1"/>
                                    <group>
                                        <group>
                                            <field name="engine_condition" readonly="1"/>
                                            <field name="brakes_condition" readonly="1"/>
                                            <field name="tires_condition" readonly="1"/>
                                        </group>
                                        <group>
                                            <field name="electrical_condition" readonly="1"/>
                                            <field name="body_condition" readonly="1"/>
                                            <field name="overall_condition" readonly="1"/>
                                        </group>
                                    </group>
                                </group>
                            </page>
                            <page string="Maintenance" name="maintenance" invisible="not is_maintenance">
                                <group>
                                    <group>
                                        <field name="is_maintenance" readonly="1"/>
                                        <field name="periodic_maintenance_interval" readonly="1"/>
                                        <field name="next_maintenance_date" invisible="state != 'done'" readonly="1"/>
                                    </group>
                                    <group>
                                        <field name="maintenance_record_id" invisible="not maintenance_record_id" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Repair Job Search View -->
        <record id="view_repair_job_search" model="ir.ui.view">
            <field name="name">auto.vehicle.repair.job.search</field>
            <field name="model">auto.vehicle.repair.job</field>
            <field name="arch" type="xml">
                <search string="Repair Jobs">
                    <field name="name"/>
                    <field name="vehicle_id"/>
                    <field name="customer_id"/>
                    <field name="assigned_mechanic_id"/>
                    <filter string="Inspection" name="state_inspection" domain="[('state', '=', 'inspection')]"/>
                    <filter string="Quotation" name="state_quotation" domain="[('state', '=', 'quotation')]"/>
                    <filter string="Waiting Approval" name="state_waiting" domain="[('state', '=', 'waiting_approval')]"/>
                    <filter string="Work Order" name="state_work_order" domain="[('state', '=', 'work_order')]"/>
                    <filter string="Done" name="state_done" domain="[('state', '=', 'done')]"/>
                    <filter string="Maintenance Jobs" name="is_maintenance" domain="[('is_maintenance', '=', True)]"/>
                    <group expand="0" string="Group By">
                        <filter string="State" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Vehicle" name="group_vehicle" context="{'group_by': 'vehicle_id'}"/>
                        <filter string="Customer" name="group_customer" context="{'group_by': 'customer_id'}"/>
                        <filter string="Mechanic" name="group_mechanic" context="{'group_by': 'assigned_mechanic_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Repair Job Kanban View -->
        <record id="view_repair_job_kanban" model="ir.ui.view">
            <field name="name">auto.vehicle.repair.job.kanban</field>
            <field name="model">auto.vehicle.repair.job</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_mobile">
                    <field name="name"/>
                    <field name="vehicle_id"/>
                    <field name="customer_id"/>
                    <field name="state"/>
                    <field name="quotation_amount"/>
                    <field name="assigned_mechanic_id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name"/>
                                            </strong>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div><field name="vehicle_id"/></div>
                                        <div><field name="customer_id"/></div>
                                        <div t-if="record.quotation_amount.raw_value">Amount: <field name="quotation_amount"/></div>
                                        <div t-if="record.assigned_mechanic_id.raw_value">Mechanic: <field name="assigned_mechanic_id"/></div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Repair Job Action -->
        <record id="action_repair_job" model="ir.actions.act_window">
            <field name="name">Repair Jobs</field>
            <field name="res_model">auto.vehicle.repair.job</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="search_view_id" ref="view_repair_job_search"/>
            <field name="context">{'default_state': 'inspection'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first repair job!
                </p>
                <p>
                    Manage the complete repair workflow: Inspection → Quotation → Approval → Work Order → Finalization.
                </p>
            </field>
        </record>

        <!-- Quotation Line Tree View -->
        <record id="view_quotation_line_tree" model="ir.ui.view">
            <field name="name">auto.vehicle.repair.quotation.line.tree</field>
            <field name="model">auto.vehicle.repair.quotation.line</field>
            <field name="arch" type="xml">
                <list string="Quotation Lines">
                    <field name="sequence" widget="handle"/>
                    <field name="product_id"/>
                    <field name="description"/>
                    <field name="quantity"/>
                    <field name="unit_price"/>
                    <field name="subtotal" readonly="1"/>
                    <field name="is_labor"/>
                </list>
            </field>
        </record>

        <!-- Quotation Line Form View -->
        <record id="view_quotation_line_form" model="ir.ui.view">
            <field name="name">auto.vehicle.repair.quotation.line.form</field>
            <field name="model">auto.vehicle.repair.quotation.line</field>
            <field name="arch" type="xml">
                <form string="Quotation Line">
                    <sheet>
                        <group>
                            <group>
                                <field name="repair_job_id" invisible="1"/>
                                <field name="sequence"/>
                                <field name="product_id"/>
                                <field name="is_labor"/>
                                <field name="labor_hours" invisible="not is_labor"/>
                            </group>
                            <group>
                                <field name="description"/>
                                <field name="quantity"/>
                                <field name="unit_price"/>
                                <field name="subtotal" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
    </data>
</odoo>
